## 背景简介

随着大数据、人工功能、云计算等 IT 技术的蓬勃发展，越来越多的政府、监管部门、银行、医院、国企、事业单位等等，正在与各大民营科技公司深度合作，以获取这些新型互联网技术的赋能。然而，这些国家重要单位有着严格的信息安全、网络安全要求，因此，它们多以私有云的方式支撑其当前乃至今后的软件系统运行。

这对科技公司的交付、维护、知识产权的保护都带来了一定程度的挑战。科技公司需要一个「桥梁」以安全的建立起数据、计算中心与客户私有云之间的联系，从而在满足客户业务诉求的同时保护自身的知识产权与商业秘密。

笔者在面向「B端」的软件架构与开发有相当程度的实战经验，服务过国企、政府部门、银行机构等，对上述痛点深以为然。于是，便希望利用业余时间将自身对上述问题的处理经验通过「cython-proxy」这个开源项目分享给大家。

结合笔者自身经验，我为本项目选用 Python 语言，主要是考虑到它具备动态特性和丰富的三方库。但是，Python 又有运行速度慢、源码保护困难等缺点，因此，在打包、部署时利用 Cython 对源代码进行处理。另一方面，本项目采用「proxy-server 反向代理模式」。Proxy 端以 Pure Python 类型工程部署在客户私有云，保持轻量级、配置化、无 HTTP 端口，仅完成必要的业务逻辑。Server 端以 Web 类型工程部署在公司的服务器集群，接收 Proxy 传回的数据等。

## 系统架构

* 系统架构图

![系统架构图](https://sam3125c.oss-cn-chengdu.aliyuncs.com/post/article0005_pic001.jpg)

* 核心逻辑程序流程图

![核心逻辑程序流程图](https://sam3125c.oss-cn-chengdu.aliyuncs.com/post/article0005_pic002.jpg)

## 模块简介

### server 模块

* 配置模块

server 端的配置模块主要用以管理大量的 proxyface 实例配置，并面向后台管理系统提供配置的增、删、改、查，以达到动态、不发版的调整 proxyface 行为。

* 请求处理模块

server 端的请求处理模块主要维护各 proxyface 的调用生命周期，处理与 proxy 交互的逻辑，从而完成将数据从 proxy 获取到的业务目的。

* 其它功能点

基于一些监控和故障定位等考虑，server 端还有需要将各 proxyface 调用流水、各 proxy 实例状态记录下来。以及提供一个 OTA-Update，作为致命故障的紧急远程升级通道。

### proxy 模块

* 请求处理模块

proxy 端的请求处理模块主要负责从远端拉取对应本 proxy 实例的请求，完成在客户私有云的业务逻辑及与客户系统的交互，最终将结果推送回 server 端。

* 其它功能点

另外，proxy 端还要监控本实例的一些基本的进程状态、服务器状态，以及提供对 OTA-Update 的支持。

## 开发进度

### server 模块

* 配置：
* [ ] 增加配置
* [ ] 删除配置
* [ ] 修改配置
* [ ] 查询配置

* 接口：
* [ ] 请求指定 proxyface 数据
* [ ] 拉取指定 proxyface 请求
* [ ] 推送指定 proxyface 响应

* 请求：
* [ ] 请求待处理
* [ ] 请求处理中
* [ ] 请求处理成功
* [ ] 请求处理失败

### proxy 模块

* 配置：
* [ ] 拉取配置

* 请求：
* [ ] 拉取请求
* [ ] 推送响应
* [ ] 推送代理机状态
* [ ] 与客户系统交互

### 其它功能点

* [x] Cython 化处理
* [ ] 请求流水记录
* [ ] 代理远程升级
* [ ] 代理机状态采集及接收

## 使用手册

使用方面主要是针对 Cython 处理而言，提供一件编译、打包脚本。`bin/build.sh` 和 `bin/build.py` 脚本完成对 py 文件的编译工作，并保证工程结构的一致性。

`bin/build_proxy.sh` 和 `bin/build_server.sh` 在其基础上做一些打包、交付的差异化工作。

同时提供 `bin/start_proxy.sh`，`bin/stop_proxy.sh`，`bin/start_server.sh`，`bin/start_server.sh` 等基本的一键启停进程脚本。

## 联系我们

如果您有关于本项目任何问题，可以直接提交 issues，也可以通过 samyang3125c@gmail.com 联系我。

I will be glad to hear from you！